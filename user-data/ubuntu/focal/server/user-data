#cloud-config
autoinstall:
  version: 1
  locale: pt_BR
  keyboard:
    layout: us
    variant: br
  storage:
    layout:
      name: direct
  ssh:
    install-server: true
    allow-pw: false
  user-data:
    package_upgrade: true
    timezone: America/Sao_Paulo
    hostname: labgrad
    users:
      - name: admin
        groups: [adm, cdrom, dip, plugdev, lxd, sudo]
        lock-passwd: false
        sudo: ALL=(ALL) NOPASSWD:ALL
        shell: /bin/bash
        ssh_authorized_keys:
          - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDKnLWMGIYoOF+pcCUVX+AqQCvMsEm1UIckj4s0neEhilqUgJbogtecQKgUmiywHYDqfu3htb+72JpS/bV6H7BFwde7sKc6HtW05iAhxVyAHYkFAGVF783KWf1sS6oQ3IAbCT7S0wHJvawhuZUACGeX8hqqpQ8TQfZUAOq93sfqeBYK+QeMjU/ampr2gY/DFc/M1ngwUugrEo1Y3zgcVyJOgdyMpwmElC0Q3AbMJymu9j+vw3fmbj5z0Rifx8QHiNJ4J0UBa5VTMlbcxxO/OcoIQ+ug8aKcPzz+kF+eTIahXvNe8l96vVBX8fvzT9gnk5AXtuXX52Y+dZzJbGJWeZ5bC0DNBsPiFDkv+V/p8C2AC6ntSLDPKaC7Vcn9ZFPGoP9ydnlhz2FZcdUt/iSD8sDKgEFmSmMg6fEck+gVrG7rCMp7WHSinfc8cw00nFXDiVIapKHmSeU63gXlvOEtaQMNRxsiKfMrj7VifL26pn2+OFGIhKQ2VV9ekdcbeRzwRjE= admin@fake-router 
  late-commands:
    # - |
    #   cat <<EOF | sudo tee /target/root/git.sh
    #   #!/bin/bash
    #   git clone git@github.com:enssilva/ubuntu-initial-config.git /target/root/ubuntu-initial-config
    #   EOF
    # - chmod +x /target/root/git.sh
    # - curtin in-target --target=/target -- ./target/root/git.sh
    - curtin in-target --target=/target -- git clone https://github.com/enssilva/ubuntu-initial-config.git /target/tmp/ubuntu-initial-config
    - curtin in-target --target=/target -- apt install python3-pip -y
    - curtin in-target --target=/target -- pip3 install ansible
    # - curtin in-target --target=/target -- ansible-playbook /target/root/ubuntu-initial-config/main.yml
    # - curtin in-target --target=/target -- pip3 install paramiko
    # - curtin in-target --target=/target -- git clone git@github.com:enssilva/ubuntu-initial-config.git /target/tmp/ubuntu-initial-config
    - curtin in-target --target=/target -- ansible-playbook /target/tmp/ubuntu-initial-config/main.yml